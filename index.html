<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SB Çağdaş Mobilya | Yönetim Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; scroll-behavior: smooth; }
        .hero-section { background-size: cover; background-position: center; transition: all 0.5s ease-in-out; }
        #loader { position: fixed; inset: 0; background: white; z-index: 10000; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s; }
        .admin-card { border: 1px solid rgba(239, 68, 68, 0.2); background: #fffafb; }
        .category-media { width: 100%; height: 250px; object-fit: cover; }
        .glass-nav { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="bg-stone-50 text-stone-900">

<!-- YÜKLEME EKRANI -->
<div id="loader">
    <div class="text-center">
        <div class="w-16 h-16 border-4 border-amber-900 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
        <p class="font-bold text-amber-900 animate-pulse tracking-widest text-xs uppercase italic">Sistem Hazırlanıyor...</p>
    </div>
</div>

<!-- ÜST BİLGİ ŞERİDİ -->
<div class="bg-amber-950 text-stone-200 py-2.5 px-6 flex justify-between items-center text-[10px] sm:text-xs font-bold uppercase tracking-widest">
    <div id="topPhoneDisplay"><i class="fas fa-phone mr-2 text-amber-500"></i> Yükleniyor...</div>
    <div class="flex gap-4">
        <a id="ig_link" target="_blank" class="hover:text-amber-400 transition text-lg"><i class="fab fa-instagram"></i></a>
        <a id="fb_link" target="_blank" class="hover:text-amber-400 transition text-lg"><i class="fab fa-facebook"></i></a>
    </div>
</div>

<!-- NAVBAR -->
<nav class="glass-nav sticky top-0 z-50 border-b px-6 py-4 flex justify-between items-center shadow-sm">
    <div class="flex flex-col">
        <span class="text-2xl font-black text-amber-950 leading-none italic uppercase tracking-tighter">SB ÇAĞDAŞ</span>
        <span class="text-[9px] font-bold text-amber-700 tracking-[0.3em] uppercase mt-1">Mobilya & Dekorasyon</span>
    </div>
    <div class="flex gap-6 items-center">
        <a href="#services" class="hidden md:block text-[10px] font-extrabold uppercase hover:text-amber-800 transition">Hizmetler</a>
        <a href="#admin-gate" class="text-red-600 hover:text-red-800 transition text-sm"><i class="fas fa-cog animate-spin-slow"></i></a>
    </div>
</nav>

<!-- HERO - KARŞILAMA -->
<header id="heroSection" class="hero-section h-[75vh] flex items-center justify-center text-white text-center px-4 relative">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="relative z-10 max-w-4xl">
        <h1 id="heroTitle" class="text-5xl md:text-8xl font-black mb-6 uppercase italic tracking-tighter drop-shadow-2xl">Yükleniyor...</h1>
        <p id="heroSubtitle" class="text-lg md:text-2xl font-light opacity-90 italic mb-10 max-w-2xl mx-auto"></p>
        <div class="flex flex-wrap justify-center gap-4">
            <a href="#services" class="bg-white text-amber-950 px-10 py-4 rounded-full font-black uppercase text-xs tracking-widest hover:bg-amber-500 hover:text-white transition shadow-2xl">Koleksiyonu Gör</a>
            <button onclick="sendWp()" class="bg-green-600 text-white px-10 py-4 rounded-full font-black uppercase text-xs tracking-widest hover:bg-green-700 transition shadow-2xl">Whatsapp Teklif</button>
        </div>
    </div>
</header>

<!-- KATEGORİLER VE MEDYA -->
<section id="services" class="py-24 px-6 container mx-auto">
    <div class="text-center mb-20">
        <span class="text-amber-800 font-bold uppercase tracking-[0.4em] text-[10px] mb-3 block">Neler Yapıyoruz?</span>
        <h2 class="text-4xl font-black italic uppercase text-stone-800 tracking-tighter">Hizmet Alanlarımız</h2>
        <div class="w-20 h-1 bg-amber-800 mx-auto mt-4 rounded-full"></div>
    </div>
    <div id="categoryGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-10">
        <!-- Kategoriler buraya dinamik gelecek -->
    </div>
</section>

<!-- İLETİŞİM -->
<section id="contact" class="py-24 bg-stone-900 text-white px-6">
    <div class="container mx-auto grid lg:grid-cols-2 gap-20">
        <div>
            <h2 class="text-4xl font-black italic uppercase mb-12 text-amber-500 tracking-tighter">İletişim</h2>
            <div id="footerContactInfo" class="space-y-10">
                <!-- Veriler yüklenecek -->
            </div>
        </div>
        <div class="bg-white/5 p-10 rounded-[2.5rem] border border-white/10 backdrop-blur-md">
            <h4 class="text-xl font-bold mb-8 uppercase text-amber-500 italic tracking-widest">Hızlı Mesaj</h4>
            <div class="space-y-5">
                <input id="userName" placeholder="Adınız Soyadınız" class="w-full p-5 rounded-2xl bg-stone-800 border-none text-white focus:ring-2 ring-amber-500 outline-none transition">
                <button onclick="sendWp()" class="w-full bg-green-600 hover:bg-green-700 p-5 rounded-2xl font-black uppercase text-xs tracking-[0.2em] transition-all flex items-center justify-center gap-4 shadow-2xl">
                    <i class="fab fa-whatsapp text-2xl"></i> WHATSAPP İLE GÖNDER
                </button>
            </div>
        </div>
    </div>
</section>

<!-- YÖNETİM PANELİ -->
<section id="admin-gate" class="py-20 bg-stone-200 px-6 border-t-8 border-red-500">
    <div id="adminLogin" class="text-center max-w-sm mx-auto">
        <i class="fas fa-lock text-4xl text-stone-400 mb-6"></i>
        <h3 class="font-black uppercase italic mb-6 tracking-widest">Yönetici Girişi</h3>
        <input id="adminPass" type="password" placeholder="Admin Şifresi" class="w-full p-4 rounded-2xl border-none shadow-inner outline-none focus:ring-2 ring-red-500 mb-4">
        <button onclick="login()" class="w-full bg-stone-800 text-white p-4 rounded-2xl font-black uppercase text-xs tracking-widest hover:bg-black transition">Sistemi Aç</button>
    </div>

    <div id="adminDashboard" class="hidden max-w-6xl mx-auto">
        <div class="bg-red-700 text-white p-8 rounded-t-[2.5rem] shadow-2xl flex flex-wrap justify-between items-center gap-4">
            <h2 class="text-2xl font-black italic uppercase tracking-tighter"><i class="fas fa-tools mr-3"></i> CANLI DÜZENLEME PANELİ</h2>
            <button onclick="saveChanges()" id="saveBtn" class="bg-green-500 hover:bg-green-600 px-10 py-4 rounded-2xl font-black text-xs uppercase shadow-2xl transition active:scale-95">SİTEYİ GÜNCELLE</button>
        </div>
        
        <div class="bg-white p-8 md:p-12 rounded-b-[2.5rem] shadow-2xl space-y-16">
            <!-- Hero Ayarları -->
            <div class="admin-card p-8 rounded-3xl">
                <h4 class="font-black text-red-600 uppercase mb-6 italic flex items-center gap-2"><i class="fas fa-image"></i> Karşılama Alanı (Hero)</h4>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-2">
                        <label class="text-[10px] font-bold uppercase text-stone-400 ml-2">Ana Başlık</label>
                        <input id="in_hTitle" class="p-4 bg-stone-50 rounded-xl border-none outline-none focus:ring-2 ring-red-500">
                    </div>
                    <div class="flex flex-col gap-2">
                        <label class="text-[10px] font-bold uppercase text-stone-400 ml-2">Alt Yazı</label>
                        <input id="in_hSub" class="p-4 bg-stone-50 rounded-xl border-none outline-none focus:ring-2 ring-red-500">
                    </div>
                    <div class="flex flex-col gap-2 md:col-span-2">
                        <label class="text-[10px] font-bold uppercase text-stone-400 ml-2">Arkaplan Fotoğraf URL</label>
                        <input id="in_hBg" class="p-4 bg-stone-50 rounded-xl border-none outline-none focus:ring-2 ring-red-500">
                    </div>
                </div>
            </div>

            <!-- Kategori / Foto / Video Ayarları -->
            <div>
                <div class="flex justify-between items-center mb-8 px-2">
                    <h4 class="font-black text-red-600 uppercase italic flex items-center gap-2"><i class="fas fa-th-large"></i> Kategoriler & Medya</h4>
                    <button onclick="addNewCat()" class="bg-amber-800 text-white px-6 py-2 rounded-xl text-[10px] font-black uppercase hover:bg-amber-900">+ YENİ EKLE</button>
                </div>
                <div id="adminCatContainer" class="space-y-6">
                    <!-- Dinamik Kategoriler -->
                </div>
            </div>

            <!-- İletişim Bilgileri -->
            <div class="admin-card p-8 rounded-3xl">
                <h4 class="font-black text-red-600 uppercase mb-6 italic flex items-center gap-2"><i class="fas fa-address-book"></i> İletişim & Sosyal Medya</h4>
                <div class="grid md:grid-cols-2 gap-8">
                    <input id="in_phone" placeholder="Telefon No" class="p-4 bg-stone-50 rounded-xl border-none outline-none focus:ring-2 ring-red-500">
                    <input id="in_email" placeholder="E-Posta" class="p-4 bg-stone-50 rounded-xl border-none outline-none focus:ring-2 ring-red-500">
                    <input id="in_loc" placeholder="Adres" class="p-4 bg-stone-50 rounded-xl border-none outline-none focus:ring-2 ring-red-500 md:col-span-2">
                    <input id="in_ig" placeholder="Instagram Link" class="p-4 bg-stone-50 rounded-xl border-none outline-none focus:ring-2 ring-red-500">
                    <input id="in_fb" placeholder="Facebook Link" class="p-4 bg-stone-50 rounded-xl border-none outline-none focus:ring-2 ring-red-500">
                </div>
            </div>
        </div>
    </div>
</section>

<footer class="bg-black py-16 text-center">
    <div class="text-amber-700 font-black italic text-xl mb-4 uppercase tracking-tighter">SB ÇAĞDAŞ MOBİLYA</div>
    <div class="text-stone-700 text-[10px] font-bold uppercase tracking-[0.5em]">Beylikdüzü / İSTANBUL &copy; 2026</div>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

const firebaseConfig = JSON.parse(__firebase_config);
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const appId = typeof __app_id !== 'undefined' ? __app_id : 'sb-cagdas-pro-v1';

// Path: artifacts/{appId}/public/data/siteData/master
const siteRef = doc(db, 'artifacts', appId, 'public', 'data', 'siteData', 'master');

let localData = {};

async function init() {
    try {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            await signInWithCustomToken(auth, __initial_auth_token);
        } else {
            await signInAnonymously(auth);
        }
        onAuthStateChanged(auth, (user) => { if (user) fetchData(); });
    } catch (e) { console.error(e); hideLoader(); }
}

function fetchData() {
    onSnapshot(siteRef, (snap) => {
        if (snap.exists()) {
            localData = snap.data();
            updateWebsite();
        } else {
            const defaults = {
                hero: { title: "Evinizdeki Sanat", sub: "30 Yıllık Marangozluk Tecrübesi", bg: "https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?q=80&w=2000" },
                categories: [
                    { id: 1, title: "Mutfak", desc: "Modern Mutfak Tasarımları", media: "https://images.unsplash.com/photo-1556911227-41a4a169b122?q=80&w=1000", type: "img" },
                    { id: 2, title: "Banyo", desc: "Şık Banyo Mobilyaları", media: "https://images.unsplash.com/photo-1584622650111-993a426fbf0a?q=80&w=1000", type: "img" }
                ],
                contact: { phone: "0541 224 52 56", email: "sbcagdasmobilya@gmail.com", loc: "Yakuplu Mah. Beylikdüzü / İSTANBUL", ig: "#", fb: "#" }
            };
            setDoc(siteRef, defaults);
        }
        hideLoader();
    }, (e) => { console.error(e); hideLoader(); });
}

function updateWebsite() {
    // Hero
    document.getElementById('heroTitle').innerText = localData.hero.title;
    document.getElementById('heroSubtitle').innerText = localData.hero.sub;
    document.getElementById('heroSection').style.backgroundImage = `url('${localData.hero.bg}')`;

    // Contact
    document.getElementById('topPhoneDisplay').innerHTML = `<i class="fas fa-phone mr-2 text-amber-500"></i> ${localData.contact.phone}`;
    document.getElementById('ig_link').href = localData.contact.ig;
    document.getElementById('fb_link').href = localData.contact.fb;
    document.getElementById('footerContactInfo').innerHTML = `
        <div class="flex gap-6 items-start">
            <div class="w-14 h-14 bg-amber-900/50 rounded-2xl flex items-center justify-center shrink-0 border border-amber-500/30"><i class="fas fa-map-marker-alt text-amber-500 text-xl"></i></div>
            <div><h4 class="text-[10px] font-bold uppercase tracking-widest text-amber-500 mb-2">Adres</h4><p class="text-xl italic opacity-80">${localData.contact.loc}</p></div>
        </div>
        <div class="flex gap-6 items-start">
            <div class="w-14 h-14 bg-amber-900/50 rounded-2xl flex items-center justify-center shrink-0 border border-amber-500/30"><i class="fas fa-phone text-amber-500 text-xl"></i></div>
            <div><h4 class="text-[10px] font-bold uppercase tracking-widest text-amber-500 mb-2">Telefon</h4><p class="text-xl italic opacity-80">${localData.contact.phone}</p></div>
        </div>
    `;

    // Categories
    const grid = document.getElementById('categoryGrid');
    grid.innerHTML = '';
    localData.categories.forEach(cat => {
        const mediaTag = cat.type === 'video' 
            ? `<video src="${cat.media}" autoplay muted loop class="category-media"></video>` 
            : `<img src="${cat.media}" class="category-media" alt="${cat.title}">`;
        
        grid.innerHTML += `
            <div class="bg-white rounded-[2.5rem] overflow-hidden shadow-sm hover:shadow-2xl transition-all group border border-stone-100">
                <div class="overflow-hidden">${mediaTag}</div>
                <div class="p-10">
                    <h3 class="font-black italic uppercase text-xl text-amber-950 mb-3">${cat.title}</h3>
                    <p class="text-sm text-stone-500 italic leading-relaxed">${cat.desc}</p>
                </div>
            </div>
        `;
    });

    if (!document.getElementById('adminDashboard').classList.contains('hidden')) renderAdmin();
}

function renderAdmin() {
    document.getElementById('in_hTitle').value = localData.hero.title;
    document.getElementById('in_hSub').value = localData.hero.sub;
    document.getElementById('in_hBg').value = localData.hero.bg;
    document.getElementById('in_phone').value = localData.contact.phone;
    document.getElementById('in_email').value = localData.contact.email;
    document.getElementById('in_loc').value = localData.contact.loc;
    document.getElementById('in_ig').value = localData.contact.ig;
    document.getElementById('in_fb').value = localData.contact.fb;

    const list = document.getElementById('adminCatContainer');
    list.innerHTML = '';
    localData.categories.forEach((cat, idx) => {
        list.innerHTML += `
            <div class="p-8 bg-stone-50 rounded-3xl border border-stone-200 grid md:grid-cols-4 gap-6 items-end relative overflow-hidden">
                <div class="flex flex-col gap-2">
                    <label class="text-[9px] font-bold uppercase text-stone-400">Başlık</label>
                    <input value="${cat.title}" onchange="updateCatItem(${idx}, 'title', this.value)" class="p-3 bg-white rounded-xl border">
                </div>
                <div class="flex flex-col gap-2">
                    <label class="text-[9px] font-bold uppercase text-stone-400">Medya URL (Foto/Video)</label>
                    <input value="${cat.media}" onchange="updateCatItem(${idx}, 'media', this.value)" class="p-3 bg-white rounded-xl border">
                </div>
                <div class="flex flex-col gap-2">
                    <label class="text-[9px] font-bold uppercase text-stone-400">Tür</label>
                    <select onchange="updateCatItem(${idx}, 'type', this.value)" class="p-3 bg-white rounded-xl border">
                        <option value="img" ${cat.type === 'img' ? 'selected' : ''}>Resim</option>
                        <option value="video" ${cat.type === 'video' ? 'selected' : ''}>Video</option>
                    </select>
                </div>
                <button onclick="removeCatItem(${idx})" class="bg-red-50 text-red-600 p-3 rounded-xl font-black text-[10px] uppercase hover:bg-red-100 transition">SİL</button>
            </div>
        `;
    });
}

window.addNewCat = () => {
    localData.categories.push({ id: Date.now(), title: "Yeni Hizmet", desc: "Buraya açıklama yazın", media: "", type: "img" });
    renderAdmin();
};

window.removeCatItem = (idx) => {
    localData.categories.splice(idx, 1);
    renderAdmin();
};

window.updateCatItem = (idx, field, val) => {
    localData.categories[idx][field] = val;
};

window.login = () => {
    if (document.getElementById('adminPass').value === "sb2026") {
        document.getElementById('adminDashboard').classList.remove('hidden');
        document.getElementById('adminLogin').classList.add('hidden');
        renderAdmin();
    } else { alert("Şifre Yanlış!"); }
};

window.saveChanges = async () => {
    if(!auth.currentUser) return;
    const btn = document.getElementById('saveBtn');
    btn.innerText = "YÜKLENİYOR...";
    btn.disabled = true;

    const dataToSave = {
        hero: {
            title: document.getElementById('in_hTitle').value,
            sub: document.getElementById('in_hSub').value,
            bg: document.getElementById('in_hBg').value
        },
        categories: localData.categories,
        contact: {
            phone: document.getElementById('in_phone').value,
            email: document.getElementById('in_email').value,
            loc: document.getElementById('in_loc').value,
            ig: document.getElementById('in_ig').value,
            fb: document.getElementById('in_fb').value
        }
    };

    try {
        await setDoc(siteRef, dataToSave);
        alert("Siteniz başarıyla güncellendi!");
    } catch (e) { alert("Hata: " + e.message); }
    finally {
        btn.innerText = "SİTEYİ GÜNCELLE";
        btn.disabled = false;
    }
};

window.sendWp = () => {
    const user = document.getElementById('userName').value || "Müşteri";
    window.open(`https://wa.me/905412245256?text=Merhaba, ben ${user}. İnternet sitenizden ulaşıyorum, modelleriniz için bilgi almak istiyorum.`, "_blank");
};

function hideLoader() { document.getElementById('loader').style.opacity = '0'; setTimeout(() => document.getElementById('loader').style.display = 'none', 500); }

init();
</script>
</body>
</html>
